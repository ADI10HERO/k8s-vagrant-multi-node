$box_image = ENV['BOX_IMAGE'] || 'fedora/30-cloud-base'.freeze

# Use iptables-legacy for iptables
$osPrepareScript = <<SCRIPT
if [ ! -f /usr/sbin/iptables-legacy ]; then
    dnf install -y iptables
fi
update-alternatives --set iptables /usr/sbin/iptables-legacy
SCRIPT

$containerRuntimeInstallScript = <<SCRIPT
set -x

retries=5
for ((i=0; i<retries; i++)); do
    dnf -y install dnf-plugins-core
    dnf config-manager \
        --add-repo \
        https://download.docker.com/linux/fedora/docker-ce.repo
    dnf install -y docker-ce docker-ce-cli containerd.io && \
        break
done
[[ $retries -eq i ]] && { echo "Failed to install docker-ce after 5 tries"; exit 1; }
SCRIPT
